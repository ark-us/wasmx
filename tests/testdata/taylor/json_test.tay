(do
(import "sdk")

(def! main (fn* (obj) (do
    (println "main" obj)
    (if (contains? obj "instantiate")
        (wasmx-finish b[])
    (if (contains? obj "identity")
        (wasmx-finish (string.encode (json-stringify (get obj "identity"))))
    (if (contains? obj "add")
        (let* (
            ret (assoc (get obj "add") "additional" {"obj" {"a" 8 "b" 9} "another" 4 })
        )
            (wasmx-finish (string.encode (json-stringify ret)))
        )
        (throw (str "function not found: " obj))
    )))
)))
(main (json-parse (get-calldata)))
)
